<html><head><base href="https://historydatefinder.com/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Historical Date Explorer</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Roboto', Arial, sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f4f4f4;
    }
    h1 {
        color: #2c3e50;
        text-align: center;
    }
    #calendar {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        overflow: hidden;
    }
    #calendar-header {
        background-color: #3498db;
        color: #fff;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    #calendar-header button {
        background: none;
        border: none;
        color: #fff;
        font-size: 1.5em;
        cursor: pointer;
    }
    #calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background-color: #ddd;
    }
    .calendar-day {
        background-color: #fff;
        padding: 10px;
        text-align: center;
        cursor: pointer;
    }
    .calendar-day:hover {
        background-color: #f0f0f0;
    }
    .calendar-day.selected {
        background-color: #3498db;
        color: #fff;
    }
    #result {
        margin-top: 20px;
    }
    .event {
        background-color: #fff;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .event h2 {
        color: #3498db;
        margin-bottom: 10px;
    }
    .event p {
        margin-bottom: 10px;
    }
    .years-ago {
        font-style: italic;
        color: #7f8c8d;
    }
    .event-image {
        max-width: 100%;
        height: auto;
        border-radius: 4px;
        margin-bottom: 10px;
    }
    .wiki-link {
        display: inline-block;
        margin-top: 10px;
        color: #3498db;
        text-decoration: none;
    }
    .wiki-link:hover {
        text-decoration: underline;
    }
    #loading {
        text-align: center;
        font-size: 1.2em;
        margin-top: 20px;
    }
</style>
</head>
<body>
    <h1>Historical Date Explorer</h1>
    <div id="calendar">
        <div id="calendar-header">
            <button id="prev-month">&lt;</button>
            <h2 id="current-month"></h2>
            <button id="next-month">&gt;</button>
        </div>
        <div id="calendar-grid"></div>
    </div>
    <div id="loading" style="display: none;">Loading events...</div>
    <div id="result"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
        const calendarGrid = document.getElementById('calendar-grid');
        const currentMonthElement = document.getElementById('current-month');
        const prevMonthButton = document.getElementById('prev-month');
        const nextMonthButton = document.getElementById('next-month');
        const result = document.getElementById('result');
        const loading = document.getElementById('loading');

        let currentDate = new Date();

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            currentMonthElement.textContent = new Date(year, month, 1).toLocaleString('default', { month: 'long' });

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            calendarGrid.innerHTML = '';

            for (let i = 0; i < firstDay; i++) {
                calendarGrid.appendChild(document.createElement('div'));
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.classList.add('calendar-day');
                dayElement.textContent = day;
                dayElement.addEventListener('click', () => selectDate(year, month, day));
                calendarGrid.appendChild(dayElement);
            }
        }

        function selectDate(year, month, day) {
            document.querySelectorAll('.calendar-day').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            getHistoricalEvents(year, month, day);
        }

        async function getHistoricalEvents(year, month, day) {
            const selectedDate = new Date(year, month, day);
            const monthForAPI = month + 1; // API expects 1-12 for months

            loading.style.display = 'block';
            result.innerHTML = '';

            try {
                const response = await axios.get(`https://history.muffinlabs.com/date/${monthForAPI}/${day}`);
                const events = response.data.data.Events;
                displayEvents(events, selectedDate);
            } catch (error) {
                console.error('Error fetching historical events:', error);
                result.innerHTML = '<p>Sorry, we couldn\'t fetch historical events for this date. Please try again later.</p>';
            } finally {
                loading.style.display = 'none';
            }
        }

        function displayEvents(events, selectedDate) {
            const currentYear = new Date().getFullYear();
            events.sort((a, b) => b.year - a.year); // Sort events in reverse chronological order

            let html = '';

            events.forEach(event => {
                const yearsAgo = currentYear - event.year;
                const wikiQuery = encodeURIComponent(event.text.split(' ').slice(0, 5).join(' ')); // Use first 5 words for image search
                const wikiLink = `https://en.wikipedia.org/wiki/Special:Search?search=${wikiQuery}`;
                let imgTag = '';
                generateImage(wikiQuery).then(img => {
                    imgTag = img.outerHTML;
                    console.log(imgTag);
                    html += `
                    <div class="event">
                        <h2>${event.year}: ${event.text}</h2>
                        ${imgTag}
                        <p>${event.text}</p>
                        <p class="years-ago">This event occurred ${yearsAgo} years ago.</p>
                        <a href="${wikiLink}" target="_blank" class="wiki-link">Learn more on Wikipedia</a>
                    </div>
                    `;
                    result.innerHTML = html;
                });

            });

            
        }

        prevMonthButton.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        nextMonthButton.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        renderCalendar();


        async function query(data) {
            const response = await fetch(
                "https://api-inference.huggingface.co/models/runwayml/stable-diffusion-v1-5",
                {
                    headers: {
                        Authorization: "Bearer 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",
                        "Content-Type": "application/json",
                    },
                    method: "POST",
                    body: JSON.stringify(data),
                }
            );
            const result = await response.blob();
            return result;
        }

        async function generateImage(prompt) {
            const request ={inputs:prompt}
            const result = await query(request);
            //console.log(result);

            const url = URL.createObjectURL(result);
            const img = new Image();
            img.src = url;
            img.classList.add('event-image');
            return img;
        }

    </script>
</body>
</html>